<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POD BATTLE ‚Äî PERFORMANCE HQ</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Barlow+Condensed:wght@300;400;500;600;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c0f;
    --bg2: #0f1318;
    --bg3: #151b22;
    --bg4: #1c2430;
    --border: #2a3540;
    --border-bright: #3d5060;
    --gold: #f5c518;
    --gold2: #c9a227;
    --orange: #f07830;
    --red: #e03030;
    --cyan: #00d4ff;
    --cyan2: #0099bb;
    --green: #3ddc84;
    --green2: #28a860;
    --white: #e8edf2;
    --muted: #6b8090;
    --text: #b0c4d0;
    --pod-a: #f5c518;
    --pod-b: #00d4ff;
    --pod-c: #f07830;
    --font-head: 'Barlow Condensed', sans-serif;
    --font-body: 'Rajdhani', sans-serif;
    --font-mono: 'Share Tech Mono', monospace;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--white);
    font-family: var(--font-body);
    min-height: 100vh;
    overflow-x: hidden;
    background-image:
      radial-gradient(ellipse 80% 40% at 50% -10%, rgba(0,212,255,0.07) 0%, transparent 60%),
      repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(255,255,255,0.015) 40px),
      repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(255,255,255,0.015) 40px);
  }

  /* SCANLINE OVERLAY */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.08) 3px);
    pointer-events: none; z-index: 9999;
  }

  /* HEADER */
  .header {
    position: relative;
    padding: 28px 40px 0;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, rgba(0,212,255,0.05) 0%, transparent 100%);
  }
  .header-top {
    display: flex; align-items: flex-start; justify-content: space-between;
    margin-bottom: 20px;
  }
  .logo-block { display: flex; align-items: center; gap: 16px; }
  .logo-icon {
    width: 52px; height: 52px;
    background: linear-gradient(135deg, var(--gold) 0%, var(--orange) 100%);
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    display: flex; align-items: center; justify-content: center;
    font-size: 22px; position: relative;
    animation: pulse-glow 3s ease-in-out infinite;
  }
  @keyframes pulse-glow {
    0%,100% { filter: drop-shadow(0 0 8px rgba(245,197,24,0.6)); }
    50% { filter: drop-shadow(0 0 20px rgba(245,197,24,0.9)); }
  }
  .logo-text { display: flex; flex-direction: column; }
  .logo-main {
    font-family: var(--font-head); font-size: 32px; font-weight: 800;
    letter-spacing: 6px; line-height: 1;
    background: linear-gradient(90deg, var(--gold) 0%, #fff 50%, var(--cyan) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-transform: uppercase;
  }
  .logo-sub {
    font-family: var(--font-mono); font-size: 11px; color: var(--muted);
    letter-spacing: 4px; margin-top: 2px;
  }
  .header-right { text-align: right; }
  .season-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--bg4), var(--bg3));
    border: 1px solid var(--gold);
    padding: 4px 14px;
    font-family: var(--font-head); font-size: 13px; font-weight: 700;
    letter-spacing: 3px; color: var(--gold); text-transform: uppercase;
    margin-bottom: 6px;
  }
  .live-indicator {
    display: flex; align-items: center; gap: 6px; justify-content: flex-end;
    font-family: var(--font-mono); font-size: 11px; color: var(--green);
  }
  .refresh-btn {
    margin-left: 10px;
    padding: 3px 10px;
    font-family: var(--font-mono); font-size: 10px; letter-spacing: 2px;
    background: transparent; border: 1px solid var(--border-bright);
    color: var(--muted); cursor: pointer; text-transform: uppercase;
    transition: all 0.2s;
  }
  .refresh-btn:hover {
    border-color: var(--cyan); color: var(--cyan);
    box-shadow: 0 0 8px rgba(0,212,255,0.2);
  }
  .refresh-btn:active { transform: scale(0.96); }
  .live-dot {
    width: 7px; height: 7px; border-radius: 50%; background: var(--green);
    animation: blink 1.2s ease-in-out infinite;
  }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

  /* TABS */
  .tabs {
    display: flex; gap: 0; margin-top: 0;
  }
  .tab {
    padding: 12px 28px;
    font-family: var(--font-head); font-size: 15px; font-weight: 700;
    letter-spacing: 3px; text-transform: uppercase;
    color: var(--muted); cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s; position: relative;
    background: transparent; border: none; outline: none;
  }
  .tab:hover { color: var(--white); }
  .tab.active {
    color: var(--cyan);
    border-bottom: 3px solid var(--cyan);
    background: linear-gradient(180deg, rgba(0,212,255,0.07) 0%, transparent 100%);
  }
  .tab.active::after {
    content: '';
    position: absolute; bottom: -1px; left: 0; right: 0; height: 1px;
    background: var(--cyan); filter: blur(3px);
  }

  /* MAIN CONTENT */
  .content { padding: 32px 40px; }
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* ============ POD BATTLE ============ */
  .battle-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 32px;
  }

  .pod-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    position: relative; overflow: hidden;
    animation: card-in 0.5s ease both;
    transition: transform 0.2s, border-color 0.2s;
  }
  .pod-card:hover { transform: translateY(-3px); }

  .pod-card:nth-child(1) { animation-delay: 0.1s; }
  .pod-card:nth-child(2) { animation-delay: 0.2s; }
  .pod-card:nth-child(3) { animation-delay: 0.3s; }
  @keyframes card-in {
    from { opacity:0; transform: translateY(20px); }
    to { opacity:1; transform: translateY(0); }
  }

  .pod-card.rank-1 { border-color: var(--gold); }
  .pod-card.rank-1::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }
  .pod-card.rank-2 { border-color: var(--cyan2); }
  .pod-card.rank-2::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
  }
  .pod-card.rank-3 { border-color: var(--border-bright); }

  .pod-header {
    padding: 18px 20px 14px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid var(--border);
    position: relative;
  }
  .pod-rank {
    font-family: var(--font-head); font-size: 56px; font-weight: 800;
    line-height: 1; opacity: 0.12; position: absolute; right: 16px; top: 8px;
    letter-spacing: -2px;
  }
  .rank-1 .pod-rank { color: var(--gold); opacity: 0.2; }
  .rank-2 .pod-rank { color: var(--cyan); opacity: 0.15; }

  .pod-name-block { display: flex; flex-direction: column; gap: 4px; }
  .pod-label {
    font-family: var(--font-mono); font-size: 10px; color: var(--muted);
    letter-spacing: 3px; text-transform: uppercase;
  }
  .pod-name {
    font-family: var(--font-head); font-size: 36px; font-weight: 800;
    letter-spacing: 2px; line-height: 1;
  }
  .rank-1 .pod-name { color: var(--gold); }
  .rank-2 .pod-name { color: var(--cyan); }
  .rank-3 .pod-name { color: var(--orange); }

  .pod-badge {
    display: flex; flex-direction: column; align-items: center; gap: 3px;
    z-index: 1;
  }
  .badge-icon {
    font-size: 28px;
    filter: drop-shadow(0 0 8px rgba(245,197,24,0.5));
  }
  .badge-label {
    font-family: var(--font-mono); font-size: 9px; color: var(--muted);
    letter-spacing: 2px;
  }

  .pod-score-main {
    padding: 20px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }
  .score-block { display: flex; flex-direction: column; gap: 2px; }
  .score-label {
    font-family: var(--font-mono); font-size: 10px; color: var(--muted); letter-spacing: 2px;
  }
  .score-value {
    font-family: var(--font-head); font-size: 44px; font-weight: 800;
    line-height: 1; letter-spacing: -1px;
  }
  .rank-1 .score-value { color: var(--gold); text-shadow: 0 0 20px rgba(245,197,24,0.4); }
  .rank-2 .score-value { color: var(--cyan); text-shadow: 0 0 20px rgba(0,212,255,0.3); }
  .rank-3 .score-value { color: var(--orange); }

  .members-block {
    display: flex; align-items: center; gap: 8px;
    font-family: var(--font-mono); font-size: 12px; color: var(--muted);
  }
  .members-count {
    font-family: var(--font-head); font-size: 24px; font-weight: 700; color: var(--white);
  }

  .pod-stats {
    padding: 16px 20px;
    display: flex; flex-direction: column; gap: 12px;
  }
  .stat-row {
    display: flex; flex-direction: column; gap: 5px;
  }
  .stat-header {
    display: flex; justify-content: space-between; align-items: center;
  }
  .stat-name {
    font-family: var(--font-mono); font-size: 10px; color: var(--muted);
    letter-spacing: 2px; text-transform: uppercase;
  }
  .stat-val {
    font-family: var(--font-head); font-size: 15px; font-weight: 700; color: var(--white);
  }
  .bar-track {
    height: 4px; background: var(--border);
    position: relative; overflow: hidden;
  }
  .bar-fill {
    height: 100%; position: absolute; left: 0; top: 0;
    transition: width 1s cubic-bezier(0.16, 1, 0.3, 1);
    animation: bar-grow 1s cubic-bezier(0.16,1,0.3,1) both;
    animation-delay: 0.6s;
  }
  @keyframes bar-grow { from { width: 0 !important; } }
  .rank-1 .bar-fill { background: linear-gradient(90deg, var(--gold2), var(--gold)); }
  .rank-2 .bar-fill { background: linear-gradient(90deg, var(--cyan2), var(--cyan)); }
  .rank-3 .bar-fill { background: linear-gradient(90deg, #b05020, var(--orange)); }

  .pod-footer {
    padding: 10px 20px;
    background: rgba(0,0,0,0.2);
    display: flex; justify-content: space-between; align-items: center;
    border-top: 1px solid var(--border);
  }
  .members-tag {
    font-family: var(--font-mono); font-size: 10px; color: var(--muted);
  }
  .delta-tag {
    font-family: var(--font-head); font-size: 13px; font-weight: 700;
    color: var(--green);
  }

  /* LEADERBOARD TABLE */
  .section-title {
    font-family: var(--font-head); font-size: 13px; font-weight: 700;
    letter-spacing: 5px; color: var(--muted); text-transform: uppercase;
    margin-bottom: 14px; display: flex; align-items: center; gap: 10px;
  }
  .section-title::after {
    content: ''; flex: 1; height: 1px; background: var(--border);
  }

  .pod-table-wrap {
    background: var(--bg2); border: 1px solid var(--border); overflow: hidden;
  }
  .pod-table {
    width: 100%; border-collapse: collapse;
    font-family: var(--font-body);
  }
  .pod-table th {
    padding: 10px 16px;
    font-family: var(--font-mono); font-size: 10px; letter-spacing: 3px;
    color: var(--muted); text-transform: uppercase; text-align: left;
    background: var(--bg3); border-bottom: 1px solid var(--border);
    font-weight: 400;
  }
  .pod-table th.right { text-align: right; }
  .pod-table td {
    padding: 12px 16px; border-bottom: 1px solid rgba(42,53,64,0.5);
    font-size: 15px; font-weight: 500;
  }
  .pod-table tr:last-child td { border-bottom: none; }
  .pod-table tr:hover td { background: rgba(0,212,255,0.04); }
  .pod-table td.right { text-align: right; }
  .rank-cell {
    font-family: var(--font-head); font-size: 20px; font-weight: 800; width: 40px;
  }
  .r1 { color: var(--gold); }
  .r2 { color: var(--cyan); }
  .r3 { color: var(--orange); }

  .score-pill {
    display: inline-block;
    padding: 3px 10px;
    font-family: var(--font-head); font-size: 16px; font-weight: 700;
    border-radius: 2px;
  }
  .sp-gold { background: rgba(245,197,24,0.15); color: var(--gold); border: 1px solid rgba(245,197,24,0.3); }
  .sp-cyan { background: rgba(0,212,255,0.1); color: var(--cyan); border: 1px solid rgba(0,212,255,0.25); }
  .sp-orange { background: rgba(240,120,48,0.12); color: var(--orange); border: 1px solid rgba(240,120,48,0.3); }

  /* ============ ACCOUNT PERFORMANCE ============ */
  .acc-table-wrap {
    background: var(--bg2); border: 1px solid var(--border); overflow: auto;
  }
  .acc-table {
    width: 100%; border-collapse: collapse; font-family: var(--font-body);
    white-space: nowrap;
  }
  .acc-table th {
    padding: 10px 14px;
    font-family: var(--font-mono); font-size: 9px; letter-spacing: 2px;
    color: var(--muted); text-transform: uppercase; text-align: left;
    background: var(--bg3); border-bottom: 1px solid var(--border);
    font-weight: 400; position: sticky; top: 0;
  }
  .acc-table td {
    padding: 10px 14px; border-bottom: 1px solid rgba(42,53,64,0.4);
    font-size: 14px; font-weight: 500; color: var(--text);
  }
  .acc-table tr:last-child td { border-bottom: none; }
  .acc-table tr:hover td { background: rgba(0,212,255,0.04); }

  .client-cell { display: flex; align-items: center; gap: 6px; }
  .pod-chip {
    display: inline-block; padding: 1px 7px;
    font-family: var(--font-mono); font-size: 10px; font-weight: 700;
    border-radius: 1px; letter-spacing: 1px;
  }
  .pod-a { background: rgba(245,197,24,0.15); color: var(--gold); border: 1px solid rgba(245,197,24,0.3); }
  .pod-b { background: rgba(0,212,255,0.1); color: var(--cyan); border: 1px solid rgba(0,212,255,0.25); }
  .pod-c { background: rgba(240,120,48,0.12); color: var(--orange); border: 1px solid rgba(240,120,48,0.3); }

  .score-num {
    font-family: var(--font-mono); font-size: 13px; font-weight: 700;
  }
  .score-high { color: #4fc3f7; }
  .score-good { color: var(--green); }
  .score-mid { color: #ffd54f; }
  .score-low { color: var(--orange); }
  .score-bad { color: var(--red); }

  .trend-up { color: var(--green); font-size: 16px; }
  .trend-dn { color: var(--red); font-size: 16px; }

  .index-val {
    font-family: var(--font-mono); font-size: 12px; color: var(--muted);
  }

  /* decorative corner */
  .corner-deco {
    position: absolute; width: 14px; height: 14px;
  }
  .corner-deco.tl { top: 0; left: 0; border-top: 2px solid; border-left: 2px solid; }
  .corner-deco.tr { top: 0; right: 0; border-top: 2px solid; border-right: 2px solid; }
  .rank-1 .corner-deco { border-color: var(--gold); }
  .rank-2 .corner-deco { border-color: var(--cyan); }
  .rank-3 .corner-deco { border-color: var(--orange); }

  /* ===== PRIZE BANNER ===== */
  .prize-banner {
    position: relative; overflow: hidden;
    background: linear-gradient(135deg, #1a1200 0%, #1f1800 40%, #120d00 100%);
    border: 1px solid var(--gold2);
    margin-bottom: 28px;
    display: flex; align-items: center; justify-content: space-between;
    gap: 20px;
    padding: 0;
  }
  .prize-banner::before {
    content: '';
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse 60% 80% at 50% 50%, rgba(245,197,24,0.08) 0%, transparent 70%);
    pointer-events: none;
  }
  .prize-banner::after {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent 0%, var(--gold) 30%, #fff8d0 50%, var(--gold) 70%, transparent 100%);
    animation: shimmer 3s ease-in-out infinite;
  }
  @keyframes shimmer {
    0%,100% { opacity: 0.7; }
    50% { opacity: 1; filter: brightness(1.4); }
  }

  .prize-left {
    display: flex; align-items: center; gap: 0;
    padding: 20px 28px;
    flex: 1;
  }
  .prize-trophy-wrap {
    position: relative; display: flex; align-items: center; justify-content: center;
    width: 110px; height: 110px; flex-shrink: 0;
  }
  .trophy-glow {
    position: absolute; inset: 0;
    background: radial-gradient(circle, rgba(245,197,24,0.25) 0%, transparent 70%);
    animation: trophy-pulse 2.5s ease-in-out infinite;
    border-radius: 50%;
  }
  @keyframes trophy-pulse {
    0%,100% { transform: scale(1); opacity: 0.7; }
    50% { transform: scale(1.15); opacity: 1; }
  }
  .trophy-emoji {
    font-size: 64px; position: relative; z-index: 1;
    filter: drop-shadow(0 0 16px rgba(245,197,24,0.8));
    animation: trophy-float 3s ease-in-out infinite;
  }
  @keyframes trophy-float {
    0%,100% { transform: translateY(0px) rotate(-3deg); }
    50% { transform: translateY(-6px) rotate(3deg); }
  }
  .prize-text { display: flex; flex-direction: column; gap: 4px; }
  .prize-eyebrow {
    font-family: var(--font-mono); font-size: 10px; letter-spacing: 5px;
    color: var(--gold2); text-transform: uppercase;
  }
  .prize-headline {
    font-family: var(--font-head); font-size: 42px; font-weight: 800;
    line-height: 1; letter-spacing: 2px;
    background: linear-gradient(135deg, #fff8c0 0%, var(--gold) 40%, #ffaa00 70%, var(--gold2) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-transform: uppercase;
  }
  .prize-sub {
    font-family: var(--font-body); font-size: 14px; font-weight: 500;
    color: var(--muted); letter-spacing: 1px; margin-top: 2px;
  }
  .prize-sub span { color: var(--gold); font-weight: 700; }

  .prize-right {
    padding: 20px 32px 20px 20px;
    display: flex; flex-direction: column; align-items: flex-end; gap: 8px;
    border-left: 1px solid rgba(245,197,24,0.15);
  }
  .chicken-dinner-label {
    font-family: var(--font-mono); font-size: 9px; letter-spacing: 4px;
    color: var(--gold2); text-transform: uppercase;
  }
  .chicken-dinner-text {
    font-family: var(--font-head); font-size: 22px; font-weight: 800;
    letter-spacing: 4px; text-transform: uppercase;
    color: var(--gold);
    text-shadow: 0 0 20px rgba(245,197,24,0.5);
    white-space: nowrap;
  }
  .chicken-emojis { font-size: 28px; letter-spacing: 4px; }
  .prize-corner-tl, .prize-corner-br {
    position: absolute; width: 20px; height: 20px;
  }
  .prize-corner-tl {
    top: 6px; left: 6px;
    border-top: 2px solid var(--gold); border-left: 2px solid var(--gold);
  }
  .prize-corner-br {
    bottom: 6px; right: 6px;
    border-bottom: 2px solid var(--gold); border-right: 2px solid var(--gold);
  }

  /* ===== POD HOVER TOOLTIP ===== */
  .pod-chip-wrap { position: relative; display: inline-block; }
  .pod-tooltip {
    position: absolute; left: 50%; transform: translateX(-50%);
    bottom: calc(100% + 10px);
    background: var(--bg3);
    border: 1px solid var(--border-bright);
    min-width: 180px; padding: 10px 14px;
    pointer-events: none; z-index: 1000;
    opacity: 0; visibility: hidden;
    transition: opacity 0.18s, visibility 0.18s, transform 0.18s;
    transform: translateX(-50%) translateY(4px);
    box-shadow: 0 8px 32px rgba(0,0,0,0.6);
  }
  .pod-chip-wrap:hover .pod-tooltip {
    opacity: 1; visibility: visible;
    transform: translateX(-50%) translateY(0);
  }
  .pod-tooltip::after {
    content: '';
    position: absolute; top: 100%; left: 50%; transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: var(--border-bright);
  }
  .tooltip-title {
    font-family: var(--font-mono); font-size: 9px; letter-spacing: 3px;
    color: var(--muted); text-transform: uppercase; margin-bottom: 8px;
    padding-bottom: 6px; border-bottom: 1px solid var(--border);
  }
  .tooltip-brand {
    display: flex; align-items: center; justify-content: space-between;
    padding: 3px 0;
    font-family: var(--font-body); font-size: 13px; font-weight: 500;
    color: var(--white);
  }
  .tooltip-brand-score {
    font-family: var(--font-mono); font-size: 11px;
  }
  .pod-a-border { border-color: var(--gold); }
  .pod-a-border .tooltip-title { color: var(--gold); }
  .pod-b-border { border-color: var(--cyan2); }
  .pod-b-border .tooltip-title { color: var(--cyan); }
  .pod-c-border { border-color: var(--orange); }
  .pod-c-border .tooltip-title { color: var(--orange); }

  /* UTILITY */
  .mt24 { margin-top: 24px; }
  .divider {
    height: 1px; background: linear-gradient(90deg, transparent, var(--border), transparent);
    margin: 28px 0;
  }

  /* ===== POD FILTER BUTTONS ===== */
  .pod-filter-btn {
    padding: 6px 16px;
    font-family: var(--font-head); font-size: 13px; font-weight: 700;
    letter-spacing: 2px; text-transform: uppercase;
    background: var(--bg4); border: 1px solid var(--border);
    color: var(--muted); cursor: pointer;
    transition: all 0.18s; outline: none;
    margin-bottom: 10px;
  }
  .pod-filter-btn:hover { color: var(--white); border-color: var(--border-bright); }

  /* ALL */
  .pod-filter-btn[data-pod="ALL"].pfb-active {
    background: rgba(255,255,255,0.07);
    border-color: var(--white); color: var(--white);
    box-shadow: 0 0 10px rgba(255,255,255,0.1);
  }
  /* Pod A ‚Äî gold */
  .pod-filter-btn[data-pod="A"].pfb-active {
    background: rgba(245,197,24,0.12);
    border-color: var(--gold); color: var(--gold);
    box-shadow: 0 0 12px rgba(245,197,24,0.2);
  }
  /* Pod B ‚Äî cyan */
  .pod-filter-btn[data-pod="B"].pfb-active {
    background: rgba(0,212,255,0.1);
    border-color: var(--cyan); color: var(--cyan);
    box-shadow: 0 0 12px rgba(0,212,255,0.2);
  }
  /* Pod C ‚Äî orange */
  .pod-filter-btn[data-pod="C"].pfb-active {
    background: rgba(240,120,48,0.12);
    border-color: var(--orange); color: var(--orange);
    box-shadow: 0 0 12px rgba(240,120,48,0.2);
  }

  @media (max-width: 900px) {
    .battle-grid { grid-template-columns: 1fr; }
    .content { padding: 20px; }
    .header { padding: 20px 20px 0; }
  }
</style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <div class="logo-block">
      <div class="logo-icon">‚öîÔ∏è</div>
      <div class="logo-text">
        <div class="logo-main">POD BATTLE HQ</div>
        <div class="logo-sub">Performance Command Center ‚Ä¢ Season Active</div>
      </div>
    </div>
    <div class="header-right">
      <div class="season-badge">Season 2025</div>
      <div style="display:flex;align-items:center;gap:10px;justify-content:flex-end;">
        <div class="live-indicator" id="live-indicator">
          <div class="live-dot"></div>
          <span style="font-family:var(--font-mono);font-size:11px;">LIVE DATA</span>
        </div>
        <button class="refresh-btn" onclick="forceRefresh()">‚ü≥ REFRESH</button>
      </div>
    </div>
  </div>
  <div class="tabs">
    <button class="tab active" onclick="switchTab('battle')">‚öîÔ∏è &nbsp;Pod Battle Sim</button>
    <button class="tab" onclick="switchTab('accounts')">üìä &nbsp;Account Performance</button>
  </div>
</div>

<div class="content">

  <!-- ===== POD BATTLE SIM ===== -->
  <div id="tab-battle" class="tab-panel active">

    <!-- PRIZE BANNER -->
    <div class="prize-banner">
      <div class="prize-corner-tl"></div>
      <div class="prize-corner-br"></div>
      <div class="prize-left">
        <div class="prize-trophy-wrap">
          <div class="trophy-glow"></div>
          <div class="trophy-emoji">üèÜ</div>
        </div>
        <div class="prize-text">
          <div class="prize-eyebrow">Winner Takes All ‚Ä¢ Quarterly Prize</div>
          <div class="prize-headline">$1,000 PRIZE</div>
          <div class="prize-sub">Awarded to <span>Top Performing Pod</span> ‚Äî Best Pod Every Quarter Takes Home the Prize.</div>
        </div>
      </div>
      <div class="prize-right">
        <div class="chicken-dinner-label">Victory Reward</div>
        <div class="chicken-dinner-text">CHICKEN DINNER</div>
        <div class="chicken-emojis">üçóüçóüçó</div>
      </div>
    </div>

    <div class="battle-grid">

      <!-- POD A ‚Äî RANK 1 -->
      <div class="pod-card rank-1">
        <div class="corner-deco tl"></div>
        <div class="corner-deco tr"></div>
        <div class="pod-header">
          <div class="pod-name-block">
            <div class="pod-label">Rank</div>
            <div class="pod-name">POD A</div>
          </div>
          <div class="pod-badge">
            <div class="badge-icon">üëë</div>
            <div class="badge-label">#1 SQUAD</div>
          </div>
          <div class="pod-rank">1</div>
        </div>
        <div class="pod-score-main">
          <div class="score-block">
            <div class="score-label">OVERALL SCORE</div>
            <div class="score-value">90.61%</div>
          </div>
          <div class="members-block">
            <div class="members-count">6</div>
            <div style="display:flex;flex-direction:column;gap:1px">
              <span style="font-size:9px;letter-spacing:2px;">SQUAD</span>
              <span style="font-size:9px;letter-spacing:2px;">MEMBERS</span>
            </div>
          </div>
        </div>
        <div class="pod-stats">
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Revision %</span>
              <span class="stat-val">94.91%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:94.91%"></div></div>
          </div>
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Backlog Completion</span>
              <span class="stat-val">94.85%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:94.85%"></div></div>
          </div>
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Ad Performance</span>
              <span class="stat-val">74%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:74%"></div></div>
          </div>
        </div>
        <div class="pod-footer">
          <span class="members-tag">6 ACTIVE OPERATORS</span>
          <span class="delta-tag">‚ñ≤ CHAMPION</span>
        </div>
      </div>

      <!-- POD C ‚Äî RANK 2 -->
      <div class="pod-card rank-2">
        <div class="corner-deco tl"></div>
        <div class="corner-deco tr"></div>
        <div class="pod-header">
          <div class="pod-name-block">
            <div class="pod-label">Rank</div>
            <div class="pod-name">POD C</div>
          </div>
          <div class="pod-badge">
            <div class="badge-icon">ü•à</div>
            <div class="badge-label">#2 SQUAD</div>
          </div>
          <div class="pod-rank">2</div>
        </div>
        <div class="pod-score-main">
          <div class="score-block">
            <div class="score-label">OVERALL SCORE</div>
            <div class="score-value">79.99%</div>
          </div>
          <div class="members-block">
            <div class="members-count">5</div>
            <div style="display:flex;flex-direction:column;gap:1px">
              <span style="font-size:9px;letter-spacing:2px;">SQUAD</span>
              <span style="font-size:9px;letter-spacing:2px;">MEMBERS</span>
            </div>
          </div>
        </div>
        <div class="pod-stats">
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Revision %</span>
              <span class="stat-val">85.29%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:85.29%"></div></div>
          </div>
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Backlog Completion</span>
              <span class="stat-val">97.53%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:97.53%"></div></div>
          </div>
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Ad Performance</span>
              <span class="stat-val">34%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:34%"></div></div>
          </div>
        </div>
        <div class="pod-footer">
          <span class="members-tag">5 ACTIVE OPERATORS</span>
          <span class="delta-tag" style="color:var(--cyan)">‚ñ≤ RUNNER-UP</span>
        </div>
      </div>

      <!-- POD B ‚Äî RANK 3 -->
      <div class="pod-card rank-3">
        <div class="corner-deco tl"></div>
        <div class="corner-deco tr"></div>
        <div class="pod-header">
          <div class="pod-name-block">
            <div class="pod-label">Rank</div>
            <div class="pod-name">POD B</div>
          </div>
          <div class="pod-badge">
            <div class="badge-icon">ü•â</div>
            <div class="badge-label">#3 SQUAD</div>
          </div>
          <div class="pod-rank">3</div>
        </div>
        <div class="pod-score-main">
          <div class="score-block">
            <div class="score-label">OVERALL SCORE</div>
            <div class="score-value">79.07%</div>
          </div>
          <div class="members-block">
            <div class="members-count">6</div>
            <div style="display:flex;flex-direction:column;gap:1px">
              <span style="font-size:9px;letter-spacing:2px;">SQUAD</span>
              <span style="font-size:9px;letter-spacing:2px;">MEMBERS</span>
            </div>
          </div>
        </div>
        <div class="pod-stats">
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Revision %</span>
              <span class="stat-val">85.85%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:85.85%"></div></div>
          </div>
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Backlog Completion</span>
              <span class="stat-val">86.36%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:86.36%"></div></div>
          </div>
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Ad Performance</span>
              <span class="stat-val">51%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:51%"></div></div>
          </div>
        </div>
        <div class="pod-footer">
          <span class="members-tag">6 ACTIVE OPERATORS</span>
          <span class="delta-tag" style="color:var(--orange)">‚ñº CLOSING IN</span>
        </div>
      </div>

    </div>

    <div class="divider"></div>

    <!-- Summary Table -->
    <div class="section-title">Battle Summary</div>
    <div class="pod-table-wrap">
      <table class="pod-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Pod</th>
            <th>Squad Size</th>
            <th>Revision %</th>
            <th>Backlog Completion</th>
            <th>Ad Performance Score</th>
            <th class="right">Final Score</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
        <tbody id="battle-tbody">
      </table>
    </div>

  </div>

  <!-- ===== ACCOUNT PERFORMANCE ===== -->
  <div id="tab-accounts" class="tab-panel">
    <div class="section-title">Account Performance ‚Äî All Clients</div>
    <div class="acc-table-wrap">
      <table class="acc-table">
        <thead>
          <tr>
            <th>Client</th>
            <th>Pod</th>
            <th>Metric</th>
            <th>Target</th>
            <th>Last Month</th>
            <th>This Month</th>
            <th>Score LM</th>
            <th>Score TM</th>
            <th>Trend</th>
          </tr>
        </thead>
        <tbody id="acc-tbody">
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
const CSV_BATTLE   = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZLrrt6HycIfJzIwgfWYfQSnZxgYsXE20ElIBqr1PB6-fwtPLUk6685Ps2FrjIzKtuWKXIdsaOg5Sr/pub?gid=722425499&single=true&output=csv';
const CSV_ACCOUNTS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZLrrt6HycIfJzIwgfWYfQSnZxgYsXE20ElIBqr1PB6-fwtPLUk6685Ps2FrjIzKtuWKXIdsaOg5Sr/pub?gid=1795723743&single=true&output=csv';
const CACHE_KEY    = 'pod_hq_v6';

// ‚îÄ‚îÄ QUARTER BADGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function() {
  const now = new Date();
  const q = Math.ceil((now.getMonth() + 1) / 3);
  document.querySelector('.season-badge').textContent = `Q${q} ${now.getFullYear()}`;
})();

// ‚îÄ‚îÄ TAB SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  event.target.closest('.tab').classList.add('active');
}

// ‚îÄ‚îÄ WIB 2AM CACHE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Returns the most recent WIB (UTC+7) 2am as a UTC timestamp
function getLastWIB2am() {
  // 2am WIB = UTC+7, so 2am WIB = 19:00 UTC previous day
  const now = new Date();
  // Get current date in WIB by offsetting UTC
  const wibOffset = 7 * 60; // minutes
  const wibNow = new Date(now.getTime() + wibOffset * 60000);
  const y  = wibNow.getUTCFullYear();
  const mo = wibNow.getUTCMonth();
  const d  = wibNow.getUTCDate();
  const h  = wibNow.getUTCHours();
  const m  = wibNow.getUTCMinutes();

  // 2am WIB in UTC = 19:00 UTC of the PREVIOUS calendar day
  // If WIB time >= 02:00 ‚Üí last cutoff was today's 2am WIB = yesterday UTC 19:00
  // If WIB time <  02:00 ‚Üí last cutoff was yesterday's 2am WIB = 2 days ago UTC 19:00
  let cutoffUTCDay;
  if (h > 2 || (h === 2 && m >= 0)) {
    // Past 2am WIB today ‚Äî cutoff is today's 2am WIB = UTC d-1 at 19:00
    cutoffUTCDay = new Date(Date.UTC(y, mo, d - 1, 19, 0, 0));
  } else {
    // Before 2am WIB today ‚Äî cutoff is yesterday's 2am WIB = UTC d-2 at 19:00
    cutoffUTCDay = new Date(Date.UTC(y, mo, d - 2, 19, 0, 0));
  }
  return cutoffUTCDay;
}
function isCacheValid() {
  try {
    const raw = localStorage.getItem(CACHE_KEY);
    if (!raw) return false;
    const { timestamp } = JSON.parse(raw);
    const saved = new Date(timestamp);
    return saved >= getLastWIB2am();
  } catch { return false; }
}

function saveCache(battleText, accText) {
  try {
    localStorage.setItem(CACHE_KEY, JSON.stringify({
      timestamp: new Date().toISOString(),
      battleText, accText
    }));
  } catch(e) {}
}

function loadCache() {
  try { return JSON.parse(localStorage.getItem(CACHE_KEY)); }
  catch { return null; }
}

// ‚îÄ‚îÄ CSV PARSER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function parseCSV(text) {
  // Strip BOM if present
  text = text.replace(/^\uFEFF/, '');
  const lines = text.trim().split(/\r?\n/);
  const rawHeaders = lines[0].split(',');
  const headers = rawHeaders.map(h => h.trim().replace(/^"|"$/g, '').replace(/\s+/g, ' '));

  console.log('CSV Headers:', headers); // debug

  return lines.slice(1).map(line => {
    const cols = [];
    let cur = '', inQ = false;
    for (let i = 0; i < line.length; i++) {
      const ch = line[i];
      if (ch === '"') { inQ = !inQ; }
      else if (ch === ',' && !inQ) { cols.push(cur.trim()); cur = ''; }
      else { cur += ch; }
    }
    cols.push(cur.trim());
    const obj = {};
    headers.forEach((h, i) => {
      obj[h] = (cols[i] || '').replace(/^"|"$/g, '').trim();
    });
    return obj;
  }).filter(r => Object.values(r).some(v => v !== ''));
}

// ‚îÄ‚îÄ FUZZY GETTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function g(row, ...keys) {
  const n = s => s.toLowerCase().replace(/[\s%_\-\/\.]/g, '');
  const rowKeys = Object.keys(row);
  for (const k of keys) {
    // Exact normalized match
    const m = rowKeys.find(rk => n(rk) === n(k));
    if (m !== undefined) return row[m] ?? '';
  }
  for (const k of keys) {
    // Partial match
    const m = rowKeys.find(rk => n(rk).includes(n(k)) || n(k).includes(n(rk)));
    if (m !== undefined) return row[m] ?? '';
  }
  return '';
}

// ‚îÄ‚îÄ VALUE PARSERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Google Sheets CSV exports percentages as decimals (0.9491) not "94.91%"
// BUT if formatted as % in sheet, it exports as "94.91%" string
// We handle both cases:
function pct(val) {
  if (val === null || val === undefined || val === '') return 0;
  const s = String(val).replace(/[$,\s]/g, '').trim();
  if (s === '' || s === '-' || s === 'N/A') return 0;
  // Strip % sign ‚Äî values come as "94.91%" from Google Sheets
  const n = parseFloat(s.replace('%',''));
  return isNaN(n) ? 0 : n;
}

function num(val) {
  if (!val) return 0;
  return parseFloat(String(val).replace(/[$,%\s]/g, '')) || 0;
}

// ‚îÄ‚îÄ SCORE FORMULA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Higher revision = BAD, so invert it
function calcScore(rev, backlog, adperf) {
  return (100 - rev) * 0.4 + backlog * 0.4 + adperf * 0.2;
}

// ‚îÄ‚îÄ STYLE HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function scoreClass(s) {
  if (s >= 75) return 'score-high';
  if (s >= 60) return 'score-good';
  if (s >= 40) return 'score-mid';
  if (s >= 20) return 'score-low';
  return 'score-bad';
}
function podClass(p) { return p==='A'?'pod-a':p==='B'?'pod-b':'pod-c'; }
function podBorderClass(p) { return p==='A'?'pod-a-border':p==='B'?'pod-b-border':'pod-c-border'; }
function rankMeta(r) {
  if (r===1) return {cls:'rank-1',icon:'üëë',label:'#1 SQUAD',nameCls:'r1',pillCls:'sp-gold',  tag:'‚ñ≤ CHAMPION',  tagColor:'var(--green)' };
  if (r===2) return {cls:'rank-2',icon:'ü•à',label:'#2 SQUAD',nameCls:'r2',pillCls:'sp-cyan',  tag:'‚ñ≤ RUNNER-UP', tagColor:'var(--cyan)'  };
  return            {cls:'rank-3',icon:'ü•â',label:'#3 SQUAD',nameCls:'r3',pillCls:'sp-orange',tag:'‚ñº CLOSING IN',tagColor:'var(--orange)'};
}

// ‚îÄ‚îÄ RENDER POD BATTLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderBattle(rows) {
  // Log first row to debug columns
  if (rows[0]) console.log('Battle row sample:', rows[0]);

  const scored = rows.map(pod => {
    const rev     = pct(pod['Revision%'] || pod['Revision'] || '');
    const backlog = pct(pod['Backlog Completion%'] || pod['Backlog Completion'] || '');
    const adperf  = pct(pod['Ad Performance Score'] || pod['Ad Performance'] || '');
    const score   = calcScore(rev, backlog, adperf);
    return { pod, rev, backlog, adperf, score };
  }).sort((a,b) => b.score - a.score);

  const grid = document.querySelector('.battle-grid');
  grid.innerHTML = '';
  scored.forEach(({pod, rev, backlog, adperf, score}, i) => {
    const rank = i+1, m = rankMeta(rank);
    const members = pod['Members'] || '‚Äî';
    grid.innerHTML += `
      <div class="pod-card ${m.cls}">
        <div class="corner-deco tl"></div><div class="corner-deco tr"></div>
        <div class="pod-header">
          <div class="pod-name-block">
            <div class="pod-label">Rank</div>
            <div class="pod-name">POD ${pod['Pod']}</div>
          </div>
          <div class="pod-badge"><div class="badge-icon">${m.icon}</div><div class="badge-label">${m.label}</div></div>
          <div class="pod-rank">${rank}</div>
        </div>
        <div class="pod-score-main">
          <div class="score-block">
            <div class="score-label">OVERALL SCORE</div>
            <div class="score-value">${score.toFixed(2)}%</div>
          </div>
          <div class="members-block">
            <div class="members-count">${members}</div>
            <div style="display:flex;flex-direction:column;gap:1px">
              <span style="font-size:9px;letter-spacing:2px;">SQUAD</span>
              <span style="font-size:9px;letter-spacing:2px;">MEMBERS</span>
            </div>
          </div>
        </div>
        <div class="pod-stats">
          <div class="stat-row">
            <div class="stat-header">
              <span class="stat-name">Revision % <span style="font-family:var(--font-mono);font-size:9px;color:var(--red);letter-spacing:1px;margin-left:4px;">‚Üì LOWER IS BETTER</span></span>
              <span class="stat-val">${rev.toFixed(2)}%</span>
            </div>
            <div class="bar-track"><div class="bar-fill" style="width:${Math.min(rev,100)}%;background:linear-gradient(90deg,#28a860,#e03030) !important;"></div></div>
          </div>
          <div class="stat-row">
            <div class="stat-header"><span class="stat-name">Backlog Completion</span><span class="stat-val">${backlog.toFixed(2)}%</span></div>
            <div class="bar-track"><div class="bar-fill" style="width:${Math.min(backlog,100)}%"></div></div>
          </div>
          <div class="stat-row">
            <div class="stat-header"><span class="stat-name">Ad Performance</span><span class="stat-val">${adperf.toFixed(0)}%</span></div>
            <div class="bar-track"><div class="bar-fill" style="width:${Math.min(adperf,100)}%"></div></div>
          </div>
        </div>
        <div class="pod-footer">
          <span class="members-tag">${members} ACTIVE OPERATORS</span>
          <span class="delta-tag" style="color:${m.tagColor}">${m.tag}</span>
        </div>
      </div>`;
  });

  const tbody = document.getElementById('battle-tbody');
  tbody.innerHTML = '';
  scored.forEach(({pod, rev, backlog, adperf, score}, i) => {
    const rank = i+1, m = rankMeta(rank), pl = pod['Pod'] || '';
    tbody.innerHTML += `
      <tr>
        <td class="rank-cell ${m.nameCls}">${rank}</td>
        <td><span class="pod-chip pod-${pl.toLowerCase()}">POD ${pl}</span></td>
        <td>${pod['Members'] || ''}</td>
        <td>${rev.toFixed(2)}%</td>
        <td>${backlog.toFixed(2)}%</td>
        <td>${adperf.toFixed(0)}%</td>
        <td style="text-align:right"><span class="score-pill ${m.pillCls}">${score.toFixed(2)}%</span></td>
      </tr>`;
  });
}

// ‚îÄ‚îÄ POD FILTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let activePod = 'ALL', allAccRows = [];

function setPodFilter(pod) {
  activePod = pod;
  document.querySelectorAll('.pod-filter-btn').forEach(b => {
    b.classList.toggle('pfb-active', b.dataset.pod === pod);
  });
  renderAccountRows();
}

function renderAccountRows() {
  const tbody = document.getElementById('acc-tbody');
  tbody.innerHTML = '';
  // Trim keys/values to avoid whitespace mismatches from CSV
  const cleaned = allAccRows.map(a => {
    const obj = {};
    Object.keys(a).forEach(k => { obj[k.trim()] = (a[k] || '').trim(); });
    return obj;
  });
  const rows = activePod === 'ALL' ? cleaned : cleaned.filter(a => a['Pod'] === activePod);
  if (!rows.length) {
    tbody.innerHTML = `<tr><td colspan="9" style="padding:24px;text-align:center;font-family:var(--font-mono);color:var(--muted);letter-spacing:2px;">NO DATA FOR POD ${activePod}</td></tr>`;
    return;
  }
  rows.forEach(a => {
    const pod = a['Pod'] || '';
    const slm = pct(a['Scoring Last Month'] || '');
    const stm = pct(a['Scoring This Month'] || '');
    const trend = a['Trend Arrow'] || '';
    const isUp = trend === '\u2191' || trend.toLowerCase().includes('up') || trend.includes('\u25b2');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><strong style="color:var(--white)">${a['Client'] || ''}</strong></td>
      <td><span class="pod-chip ${podClass(pod)}">POD ${pod}</span></td>
      <td style="font-family:var(--font-mono);font-size:11px;color:var(--muted)">${a['Metric Type'] || ''}</td>
      <td style="font-size:12px;color:var(--muted)">${a['Target Text'] || ''}</td>
      <td style="font-family:var(--font-mono);font-size:13px">${a['Last Month'] || ''}</td>
      <td style="font-family:var(--font-mono);font-size:13px">${a['This Month'] || ''}</td>
      <td><span class="score-num ${scoreClass(slm)}">${slm.toFixed(1)}%</span></td>
      <td><span class="score-num ${scoreClass(stm)}">${stm.toFixed(1)}%</span></td>
      <td class="${isUp ? 'trend-up' : 'trend-dn'}">${isUp ? '\u2191' : '\u2193'}</td>`;
    tbody.appendChild(tr);
  });
}

function renderAccounts(rows) {
  // Trim all keys/values from CSV parsing artifacts
  allAccRows = rows.map(a => {
    const obj = {};
    Object.keys(a).forEach(k => { obj[k.trim()] = (a[k] || '').trim(); });
    return obj;
  });
  if (allAccRows[0]) console.log('Account row sample:', allAccRows[0]);

  if (!document.getElementById('pod-filter-bar')) {
    const wrap = document.querySelector('.acc-table-wrap');
    const bar = document.createElement('div');
    bar.id = 'pod-filter-bar';
    bar.style.cssText = 'display:flex;gap:8px;padding:14px 16px 0;background:var(--bg3);border-bottom:1px solid var(--border);flex-wrap:wrap;align-items:center;';
    const lbl = document.createElement('span');
    lbl.style.cssText = 'font-family:var(--font-mono);font-size:9px;letter-spacing:3px;color:var(--muted);margin-right:4px;';
    lbl.textContent = 'FILTER BY POD:';
    bar.appendChild(lbl);
    [['ALL','ALL PODS'],['A','POD A'],['B','POD B'],['C','POD C']].forEach(([key,label]) => {
      const btn = document.createElement('button');
      btn.className = `pod-filter-btn${key==='ALL'?' pfb-active':''}`;
      btn.dataset.pod = key;
      btn.textContent = label;
      btn.onclick = () => setPodFilter(key);
      bar.appendChild(btn);
    });
    wrap.insertBefore(bar, wrap.firstChild);
  }
  renderAccountRows();
}

// ‚îÄ‚îÄ LOADING / STATUS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setStatus(html, color='var(--green)') {
  const el = document.querySelector('.live-indicator');
  if (el) el.innerHTML = html;
}
function setLoading(msg) {
  document.querySelector('.battle-grid').innerHTML =
    `<div style="grid-column:1/-1;padding:40px;text-align:center;font-family:var(--font-mono);color:var(--muted);letter-spacing:3px;">${msg}</div>`;
  document.getElementById('acc-tbody').innerHTML =
    `<tr><td colspan="9" style="padding:30px;text-align:center;font-family:var(--font-mono);color:var(--muted);letter-spacing:2px;">${msg}</td></tr>`;
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function resetRefreshBtn() {
  const btn = document.querySelector('.refresh-btn');
  if (btn) { btn.textContent = '‚ü≥ REFRESH'; btn.style.color = ''; btn.disabled = false; }
}

async function forceRefresh() {
  const btn = document.querySelector('.refresh-btn');
  if (btn) { btn.textContent = '‚ü≥ SYNCING...'; btn.style.color = 'var(--cyan)'; btn.disabled = true; }
  localStorage.removeItem(CACHE_KEY);
  setLoading('‚ü≥ FORCE REFRESHING...');
  try {
    const [br, ar] = await Promise.all([fetch(CSV_BATTLE), fetch(CSV_ACCOUNTS)]);
    const [bt, at] = await Promise.all([br.text(), ar.text()]);
    saveCache(bt, at);
    renderBattle(parseCSV(bt));
    renderAccounts(parseCSV(at));
    setStatus(`<div class="live-dot"></div> <span style="font-family:var(--font-mono);font-size:11px;color:var(--green);">LIVE ¬∑ REFRESHES 02:00 WIB</span>`);
  } catch(err) {
    setStatus(`<div class="live-dot" style="background:var(--red)"></div> <span style="color:var(--red);font-family:var(--font-mono);font-size:11px;">REFRESH FAILED ‚Äî CHECK CONNECTION</span>`);
    console.error(err);
  } finally {
    resetRefreshBtn();
  }
}

async function init() {
  // Instant render from cache if still valid (refreshes at 2am WIB)
  if (isCacheValid()) {
    const cache = loadCache();
    if (cache) {
      renderBattle(parseCSV(cache.battleText));
      renderAccounts(parseCSV(cache.accText));
      const next2am = new Date(getLastWIB2am().getTime() + 86400000);
      const hhmm = next2am.toLocaleTimeString('en-GB', {hour:'2-digit',minute:'2-digit',timeZone:'Asia/Jakarta'});
      setStatus(`<div class="live-dot" style="background:var(--gold)"></div> <span style="color:var(--gold);font-family:var(--font-mono);font-size:11px;">CACHED ¬∑ NEXT REFRESH ${hhmm} WIB</span>`);
      return;
    }
  }

  // Fetch fresh
  setLoading('‚ü≥ SYNCING LIVE DATA...');
  try {
    const [br, ar] = await Promise.all([fetch(CSV_BATTLE), fetch(CSV_ACCOUNTS)]);
    const [bt, at] = await Promise.all([br.text(), ar.text()]);
    saveCache(bt, at);
    renderBattle(parseCSV(bt));
    renderAccounts(parseCSV(at));
    setStatus(`<div class="live-dot"></div> <span style="font-family:var(--font-mono);font-size:11px;color:var(--green);">LIVE ¬∑ REFRESHES 02:00 WIB</span>`);
  } catch(err) {
    const cache = loadCache();
    if (cache) {
      renderBattle(parseCSV(cache.battleText));
      renderAccounts(parseCSV(cache.accText));
      setStatus(`<div class="live-dot" style="background:var(--orange)"></div> <span style="color:var(--orange);font-family:var(--font-mono);font-size:11px;">STALE CACHE</span>`);
    } else {
      setLoading('‚ö† FAILED TO LOAD ‚Äî Check sheet is published publicly');
    }
    console.error(err);
  }
}

init();
</script>
</body>
</html>
